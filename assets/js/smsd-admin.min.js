/**
 * Js custom for Plugin SM Slider ( Slider Options )
 * Required jQuery 1.7+ & jQuery UI
 * @Author Simon Jan - skype maitaget
 */
!function(e,t,a){"use trict";var i={"int":function(){i.app(),i.controlPreview()},app:function(){var t=a("#smsd-toolbar"),n=a("#major-publishing"),s=a("#sm-mangslide"),d=a("#insert-media-button"),r=a("#sm-att-undo"),l=a("#smsd-name"),o=a("#smsd-alias"),c=a("#smsd-tab-slide"),m=a("#smsd-tab-content"),u=a("#sm-to-top"),f=a("#setting-thumb"),p=a("ul.list-thumb"),h=a("#sm-params"),v="input.smsd-pos-id",g=a("#accordion");if(n.append(a("#major-publishing-actions").html()),a(e).on("resize scroll",function(){var i=a(e).scrollTop(),s=t.attr("data-added");i>150?"false"==s&&(r.detach().insertBefore(n),t.fadeIn(500,function(){a(this).attr("data-added","true")})):"true"==s&&t.fadeOut(300,function(){r.detach().insertBefore("#insert-media-button"),a(this).attr("data-added","false")})}),a("#the-list").on("click",".sm-delete",function(t){t.preventDefault();var n=a(this).attr("id"),s={};n=i.getId(n),s.slide=n,confirm("Are you sure?")&&i.slideAction("delete",s).done(function(t){t.length>0?e.location.reload():alert("Sorry, it is not OKI for now. Please try again, thanks.")})}).on("click",".sm-copy",function(t){t.preventDefault();var n=a(this).attr("id"),s=a(this).closest("td").prev("td").text(),d={};s=s.replace(/\[smslider[\s+]|\]/gi,"")+"-copy",s=prompt("Please enter alias name",s),s=s.replace(/[^a-z0-9_\-]/gi,"-"),s=s.replace(/(^[0-9]+)?(.*)/g,"$2$1"),n=i.getId(n),d.slide=n,d.alias=s,i.slideAction("copy",d).done(function(t){t.length>0?(t=t.substr(t.indexOf("admin.php"),t.length),t.length<3&&(t="?page=sm-slider"),e.location.href=t):alert("Sorry, it is not OKI for now. Please try again, thanks.")})}),s.on("click",".sm-trash",function(e){e.preventDefault();var t=a(this).attr("data-target"),n=r.attr("data-range"),d=a(this).closest("tr.slide");if(t=i.getId(t),confirm("Are you sure?")){var l=a("#smslider-box").find("#sm-recycle");0===l.length&&(l=a("<table/>",{id:"sm-recycle","class":"hidden"}).appendTo("#smslider-box")),d.fadeOut("300",function(){slide=i.makeId()+t,a(this).find(v).length>0&&(t=parseInt(a(this).find(v).val())),a(this).detach().appendTo(l).attr("id","att-"+slide),0===s.find("tr.slide").length&&a(".slide-empty").fadeIn().removeClass("hidden"),n+=","+slide,r.attr("data-range",n).removeClass("disabled"),a("#postdivrich").append('<input type="hidden" name="delete[]" id="smip-'+slide+'" value="'+t+'">'),s.trigger("updateOrder")})}}).on("click",".sm-more",function(e){e.preventDefault();var t=a(this),i=0;t.hasClass("sm-unmore")||(i=-t.next(".sm-more-seo").height()),t.toggleClass("sm-unmore").parent().stop().animate({"margin-top":i},500,function(){var e=a(this).find(".sm-more-seo");0==i?e.fadeOut():e.fadeIn()})}).on("click",".sm-edit",function(e){e.preventDefault();var t=a(this).closest(".slide"),i=!0,n=!1;i&&confirm("Are you want replace current info of caption, url, title, etc..?")&&(n=!0),d.trigger("insertMedia",[!1,t,n])}).on("click",".sm-clone",function(e){e.preventDefault();{var t,n,d=a(this).closest(".slide").clone(),r=a(this).attr("data-target"),l=s.children().length;-1!=r.indexOf("video")?1:0}d.find(v).remove(),t=d.html(),t=i.resetId(t,l),d.attr("id","slide-"+l).empty().append(t).appendTo(s),s.find(".smsd-tabs").tabs(),n=i.getPos(d.last().offset().top),i.goPos(n,500)}).on("change",".widefat",function(){a(this).is("textarea")?a(this).text(a(this).val()):a(this).attr("value",a(this).val())}).on("click",".tab-item",function(e){e.preventDefault();var t=a(this).attr("href"),i=a(t).siblings(".tabs-panel");-1!=t.indexOf("video")?a(this).closest("tr").find(".thumb").addClass("video"):a(this).closest("tr").find(".thumb").removeClass("video"),a(t).find(".widefat").removeAttr("disabled"),i.find(".widefat").attr("disabled","disabled")}),a(".disabled").on("click",function(e){e.preventDefault()}),r.on("click",function(t){t.preventDefault();var n=a(this).attr("data-range"),d=n.lastIndexOf(","),r=0,l="",o=s.children().length;r=n.substr(d+1,n.length),a("#postdivrich").find("#smip-"+r).remove(),n=n.substr(0,d),a(this).attr("data-range",n),a(".slide-empty").fadeOut();var c=a("#att-"+r).detach();l=c.html(),l?l=i.resetId(l,o):e.location.reload(),c.attr("id","slide-"+o).empty().append(l).appendTo(s).fadeIn("400"),n.length<1&&a(this).addClass("disabled"),i.goPos(s.find(".slide").last().offset().top-50,800)}),l.on("change",function(){var e=a(this).val(),t=a('input[name="slide_alias"]').val();i.passField(a(this),["required","min:3"],"Slider name")&&0==o.val().length&&(e=i.slideSlug(e),o.prop("value",e),i.checkAlias(o)&&i.aliasExist(o,e,t,a(this).attr("data-act")))}),o.on("change",function(){var e=a(this).val(),t=a('input[name="slide_alias"]').val();i.checkAlias(o)&&(e=i.slideSlug(e),o.prop("value",e),i.aliasExist(o,e,t,a(this).attr("data-act")))}),a("#smsd-form-add-new").on("submit",function(e){return 0===a(this).find("input.error").length&&i.passField(l,["required","min:3"],"Slider name")&&i.checkAlias(o)?!0:void e.preventDefault()}),a(".sm-ui-sortable").sortable({items:"tr:not(.slide-empty)",update:function(){s.trigger("updateOrder")}}),a(".smsd-setting-tabs,.smsd-tab-image").tabs(),a(".smsd-tab-video").tabs({active:1}),c.length>0){var b=a("<span>",{"class":"empty-default",text:"Nice to meet you!"}),x=m.children(".tabs-active");a(".sm-dropable").droppable({drop:function(e,t){var i=t.draggable,n=(i.parent(),a("#"+i.attr("data-parent"))),s=i.find("input[type=checkbox]");if(console.log(n),i.find(".description").remove(),s.length>0){var d=s.clone().attr({type:"hidden",id:"field_"+i.attr("id"),value:!1});s.is(":checked")||d.removeAttr("disabled"),x.append(d)}a(this).find(".empty-default").remove(),i.detach().css({top:0,left:0}).find(".field-item").removeAttr("disabled").end().appendTo(a(this)),n.find("option:selected").first().attr("disabled","disabled")}}),a(".sm-dragable").droppable({drop:function(e,t){var i=t.draggable,n=i.attr("id"),s=i.parent(),d=a("#"+i.attr("data-parent")),r=i.find("input[type=checkbox]");a(this).find(".empty-default").remove(),r.length>0&&x.find("#field_"+n).remove(),i.remove(),d.find("option[value="+n.substring(n.lastIndexOf("-")+1)+"]").removeAttr("disabled"),0==s.children().length&&s.append(b.clone())}}),a(".dragable").draggable({revert:"invalid"}),a(".smop-select").on("change click",function(){i.renderField(a(this).find("option:selected"),a(this).parent())});var y=c.children(".smsd-active").index();y=y>0?y:0,c.parent().tabs({active:y}),c.on("click",".tab-item",function(e){e.preventDefault();var t=a(this).attr("href"),i=a(t),t=t.replace("#",""),n=a(this).closest(".smsd-tabs");n.find("input").prop("value",t),n.children(".tabs-panel").not(i).removeClass("tabs-active").find(".sm-dropable").find(".field-item").attr("disabled",!0),i.addClass("tabs-active").find(".sm-dropable").find(".field-item").removeAttr("disabled")}),m.on("change",'input[type="number"]',function(){i.passField(a(this),["required","number"],a(this).prev("h4").text())}).on("change",'input[type="checkbox"]',function(){var e=a(this).parent().attr("id"),t=x.find("#field_"+e);0==t.length&&(t=a(this).clone().attr({type:"hidden",id:"field_"+e,value:0}),t.appendTo(x)),a(this).is(":checked")?t.prop("disabled",!0):t.prop("disabled",!1)})}s.on("updateOrder",function(e){a(this).children("tr.slide").each(function(e){var t=a(this).html(),n=a(this).index();t=i.resetId(t,n),a(this).attr("id","slide-"+n).empty().append(t)})}),d.on("insertMedia",function(t,n,d,r){t.preventDefault(),i.sm_media_frame&&(i.sm_media_frame=null),i.sm_media_frame=wp.media.frames.sm_media_frame=wp.media({title:"Choose Image Insert",button:{text:"Add to slider"},multiple:n}),i.sm_media_frame.on("select",function(){var t,l=i.sm_media_frame.state().get("selection");if(n){var o=s.children().length,c=s.children("tr").eq(o-1);l.map(function(t){t=t.toJSON(),slide=smsd_temp.replace(/smsd_id|smsd_i|smsd_url|smsd_caption|smsd_title|smsd_alt/g,function(e){return e=e.replace("smsd_",""),"id"===e?i.getUniq(t[e]):"i"===e?o:"url"===e?t.sizes.thumbnail[e]:"alt"===e?""!=t[e]?t[e]:t.title:t[e]});var n=s.find(".slide");n.length>0?n=n.last().clone().empty():a("#sm-recycle").find(".slide").length?n=a("#sm-recycle").find(".slide").first().clone().empty():e.location.reload(),n.attr("id","slide-"+o).append(slide).hide().addClass("added").appendTo(s).slideDown("400");var d=c.next(".slide"),r=i.getPos(d.offset().top);i.goPos(r,800,function(){0==d.find("textarea").val().length&&i.goMore(d,s,27)}),o++})}else{attachment=l.first().toJSON();var m=d.find("a.sm-trash").attr("data-target"),u=d.html();m=i.getId(m),slide=i.getUniq(m);var f=new RegExp(slide,"g");u=u.replace(f,i.getUniq(attachment.id)),d.empty().append(u).hide().fadeIn("400"),d.find(".thumb").css("background-image","url("+attachment.sizes.thumbnail.url+")"),r&&(d.find("input").each(function(){var e=a(this).context.name,t=e.match(/image.*(title|alt)/i);null!=t&&a(this).attr("value",attachment.title)}),attachment.caption.length>0?(d.find("textarea").text(attachment.caption),i.goMore(d,s,0)):i.goMore(d,s,27)),t=i.getPos(d.offset().top),i.goPos(t,800)}s.find(".smsd-tabs").tabs()}),i.sm_media_frame.open()}),d.on("click",function(){a(this).trigger("insertMedia",[!0])}),a("#smsd-toolbar").find(".insert-media-button").on("click",function(){d.trigger("insertMedia",[!0])}),u.on("click",function(e){e.preventDefault(),i.goPos(0,800)}),a(".sm-toolbar a").on("click",function(e){e.preventDefault();var t=a(this).attr("id"),i=a(this).parent().next(i),n=i.val(),s=i[0].selectionStart;t=t.substring(3),t="["+t+"]",i.val(s?n.substring(0,s)+t+n.substring(s):n+t)}),a("#setting-loop input, .smsd-setting").focus(function(){h.attr("value",1)}),a("#sm-has-page").on("click",function(){a(this).is(":checked")?(f.removeAttr("disabled"),a("#sm-has-thumnbail").slideDown()):(a("#sm-has-thumnbail").slideUp(),f.attr("disabled","disabled"))}),f.on("focus",function(){p.fadeIn()}).on("change",function(){p.fadeOut()}),p.on("click","a",function(e){e.preventDefault();var t=a(this).attr("id");f.attr("value",t),p.fadeOut(),h.attr("value",1)}),g.length>0&&(a("#accordion").accordion(),g.find("select.manage_slider").each(function(){"true"===a(this).val()&&a(this).closest(".smsd-table").prev("h3").addClass("role-enabled")}),a(".smsd-lib-type").on("click",":checkbox",function(){var e=a(this).closest("td").find(":checkbox:checked").length;return e>2?!1:void(a(this).is(":checked")?a(this).parent().next("p").slideDown():a(this).parent().next("p").slideUp())})),a(e).on("scroll",function(){a(this).scrollTop()>100?u.fadeIn():u.fadeOut()})},slideValid:function(e,t,i,n){var s=n?n:t.attr("id")+"-msg",d=t.next("#"+s);e?(t.removeClass("error").addClass("valid"),d.fadeOut()):(0===d.length&&(d=a("<span>",{id:s,"class":"smsd-error hidden"}),t.after(d)),d.text(i).fadeIn(),t.removeClass("valid").addClass("error").focus())},checkAlias:function(e){return i.passField(e,["required","min:3","alias"],"Alias name")},aliasExist:function(e,t,n,s){t=t?t:e.val(),i.slideAction("alias",{alias:t,act:s,old:n}).done(function(t){t=a.parseJSON(t),i.slideValid(0===t,e,"Alias name already exists!")})},slideSlug:function(e){return e.replace(/\s+/gi,"-").toLowerCase()},slideAction:function(e,t){var i={action:"smsd-act_"+e,sm_nonce:_smsd.sm_nonce};return t=a.extend(i,t),a.post(_smsd.ajax_url,t)},goPos:function(e,t,i){a("html, body").stop().animate({scrollTop:e},t,i)},getId:function(e){return parseInt(e.substr(e.lastIndexOf("_")+1,e.length))},getUniq:function(e){return _smsd.sm_nonce.substr(0,5)+"_"+e},makeId:function(){for(var e="",t="abcdefghijklmnopqrstuvwxyz0123456789-",a=0;5>a;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e+"_"},resetId:function(e,t){return e=e.replace(/(-smsd-)([\d]+)/g,"$1"+t).replace(/(type\[[\w_]+[\d]+\]\[)([\d]+)(\])/g,"$1"+t+"$3")},getPos:function(e){return e>200&&(e-=40),e-50},renderField:function(e,t){var n=e.attr("data-type"),s=e.val(),d=t.attr("id"),r=e.attr("data-desc"),l=a("<div>",{id:d.substring(0,d.lastIndexOf("-")+1)+s,"data-parent":t.attr("id"),"class":"field-items dragable"});l.append("<h4>"+s+"</h4>"),s="options["+s+"]",l.append("select"===n?i.newSelect(s,e.attr("data-value"),e.attr("data-default")):"textarea"===n?i.newTextarea(s):"boolean"===n?i.newBoolean(s,e.attr("data-default")):i.newInput(s,e.attr("data-type"),e.attr("data-default"))),r&&(r='<p class="description">'+r+"</p>",l.append(r)),t.children(".field-items").remove().end().append(l),a(".tab-tool").find(".dragable").draggable({revert:"invalid"})},newSelect:function(e,t,i){var n=a("<select>",{name:e,"class":"item-select field-item widefat",disabled:!0}),t=t.split(",");return a.each(t,function(e,t){var s=a("<option>",{value:t,text:t});t===i&&s.attr("selected","true"),n.append(s)}),n},newInput:function(e,t,i){return a("<input/>",{type:t,name:e,value:i,"class":"item-input field-item widefat",disabled:!0})},newBoolean:function(e,t){var i=a("<input/>",{name:e,type:"checkbox",value:!0,"class":"item-checkbox field-item",disabled:!0});return"true"===t&&i.prop("checked",!0),i},newTextarea:function(e){return a("<textarea>",{name:e,rows:4,"class":"area-item field-item widefat",disabled:!0})},renderMsg:function(e,t){var i=a("<span>",{id:e,"class":"smsd-error"});return i.text(t)},render_id:function(e){return e+"-msg"},goMore:function(e,t,a){a&&(a=-e.find(".sm-more-seo").first().fadeIn().height()),e=e.find(".image-wrap").first(),e.animate({"margin-top":a},400,function(){a?e.find(".sm-more").addClass("sm-unmore"):(e.find(".sm-more").removeClass("sm-unmore"),e.find(".sm-more-seo").fadeOut()),t.find(".added").removeClass("added")})},passField:function(e,t,n){var s=!0,d=i.render_id(e.attr("id")),r=e.val();return a.each(t,function(t,a){switch(a=a.split(":"),add=a[1]?a[1]:0,a[0]){case"required":s=r.trim().length>0,msg=n+" is required!";break;case"min":s=r.trim().length>=add,msg="Please enter at least "+add+" characters.";break;case"alias":s=/^[a-zA-Z]+[\w -]*$/.test(r),msg=n+" only include letters, numbers, underscores, and hyphens";break;case"number":s=/[\d]+/.test(r),msg="Please enter only digits"}return i.slideValid(s,e,msg,d),s?void 0:s}),s},controlPreview:function(){var e=a("#sm-preview"),t=a("#close-preview");return 0===e.length?!1:(t.on("click",function(t){e.slideUp(500),t.preventDefault()}),void a("#smslider-box").on("click","#post-preview",function(t){e.zIndex(9999).css("visibility","visible").hide().slideDown(800),t.preventDefault()}))}};i["int"]()}(window,document,window.jQuery);